<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>

    <script>

        // your web config

        // end web config

        var auth;

        var storage;

        var db;

        var dtTable;

        function initFirebase() {

            console.log("init firebase");

            auth = firebase.auth();

            storage = firebase.storage();

            db = firebase.firestore();

            //onAuthStateChanged(this);

        }

        function getData() {

            var query = db.collection("map-services");

            query.orderBy("id", "desc")

                .get().then(function (docData) {

                    if (docData.size) {

                        var arrObj = [];

                        docData.forEach(function (data) {

                            var obj = data.data();

                            obj.id = data.id; // assign id to data;

                            arrObj.push(obj);

                        });

                        console.log("data", arrObj);

                        dtTable.clear();

                        dtTable.rows.add(arrObj);

                        //dtTable.draw();

                        dtTable.order([0, 'desc']).draw();

                    } else {

                    }

                }, function (error) {

                    console.log("error=", error);

                });

        }

        function saveData() {

            var id = $("#hd-id").val();

            var name = $("#txt-name").val();

            var email = $("#txt-email").val();

            var phone = $("#txt-phone").val();

            var data = {

                name: name,

                email: email,

                phone: phone

            }

            if (!data.id) {

                addDB(data);

            } else {

                updateDB(data);

            }

        }

        function deleteData() {

            var id = $("#hd-id").val();

            deleteDB(id);

        }

        function addDB(obj) {

            obj.createDate = firebase.firestore.FieldValue.serverTimestamp();

            db.collection("employees").doc().set(obj)

                .then(function () {

                    getData();

                    $('#myModal').modal('toggle');

                })

                .catch(function (error) {

                    console.error("Error writing document: ", error);

                });

        }

        function updateDB(obj) {

            obj.updateDate = firebase.firestore.FieldValue.serverTimestamp();

            db.collection("employees").doc(obj.id).update(obj)

                .then(function () {

                    getData();

                    $('#myModal').modal('toggle');

                });

        }

        function deleteDB(id) {

            db.collection("employees").doc(id).delete()

                .then(function () {

                    getData();

                    $('#myModal').modal('toggle');

                });

        }

        function clearInput() {

            $("#hd-id").val('');

            $("#txt-name").val('');

            $("#txt-email").val('');

            $("#txt-phone").val('');

        }

        $(document).ready(function () {

            dtTable = $('#example').DataTable({

                columns: [

                    { data: "createDate" },

                    { data: "id" },

                    { data: "name" },

                    { data: "region" },

                    { data: "category" },

                    { data: "opacity" },

                    { data: "url" },

                    { data: "description" },

                    { data: "provider_url" },

                    { data: "legend_url" },

                    { data: "layers" },

                    { data: "timeseries" },

                    { data: "params" }

                ],

                columnDefs: [

                    { targets: [0], visible: false },

                    { targets: [1], visible: false }

                ]

            });

            dtTable.on('click', 'tr', function () {

                if ($(this).hasClass('selected')) {

                    $(this).removeClass('selected');

                }

                else {

                    dtTable.$('tr.selected').removeClass('selected');

                    $(this).addClass('selected');

                }

                if (dtTable.row(this).data()) {

                    var selectedData = dtTable.row(this).data();

                    //console.log("select=", selectedData);

                    clearInput();

                    $("#hd-id").val(selectedData.id);

                    $("#txt-name").val(selectedData.name);

                    $("#txt-email").val(selectedData.email);

                    $("#txt-phone").val(selectedData.phone);

                    $('#myModal').modal('show')

                    $("#btnDelete").show();

                }

            });

            $("#btnAdd").on('click', function () {

                clearInput();

                $('#myModal').modal('show')

                $("#btnDelete").hide();

            });

            $("#btnSave").on('click', function () {

                saveData();

            });

            $("#btnDelete").on('click', function () {

                deleteData();

            });

            initFirebase();

            getData();

        });

    </script>



</head>
<body>

</body>
</html>